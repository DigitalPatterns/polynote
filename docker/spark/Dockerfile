ARG POLYNOTE_VERSION
ARG SCALA_VERSION
ARG SPARK_VERSION
ARG HADOOP_VERSION
ARG HADOOP_VERSION_MAJOR

FROM polynote-j11:${POLYNOTE_VERSION}-${SCALA_VERSION}

ARG POLYNOTE_VERSION
ARG SCALA_VERSION
ARG SPARK_VERSION
ARG HADOOP_VERSION
ARG HADOOP_VERSION_MAJOR


WORKDIR /opt

USER root

COPY install_spark.sh .

RUN chmod +x install_spark.sh && \
    ./install_spark.sh ${SCALA_VERSION} ${SPARK_VERSION} ${HADOOP_VERSION} ${HADOOP_VERSION_MAJOR} && \
    rm ./install_spark.sh

ENV SPARK_HOME="/opt/spark"
ENV HADOOP_HOME="/opt/hadoop-${HADOOP_VESION}"
ENV PATH="$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin"

# switch to non-root user
USER ${NB_USER}
